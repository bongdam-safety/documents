# JDK 설치
## Temurin JDK 설치

[설치링크](https://adoptium.net/temurin/releases/?os=windows&arch=x64&package=jdk&version=17)

자바 버전은 17로 다운받습니다.
자바 21로도 해봤는데, 그러면 콘솔에 한글이 깨져서 출력되더라고요

## 환경 변수 설정

1. 윈도우 버튼 클릭
2. 시스템 환경 변수 편집 입력 및 클릭
3. 환경 변수(N)... 클릭
6. 하단 '시스템 변수'에 있는 새로 만들기 -> 변수 이름 JAVA_HOME, 변수 값: jdk 경로 (예: C:\Program Files\Eclipse Adoptium\jdk-17.0.12.7-hotspot\\) -> 확인
7. 하단의 시스템 변수에 있는 Path 더블클릭 -> jdk 경로의 bin 추가 (예: C:\Program Files\Eclipse Adoptium\jdk-17.0.12.7-hotspot\bin) -> 확인

# IntelliJ 학생용

[무료 교육용 라이선스 소개](https://www.jetbrains.com/ko-kr/community/education/#students)

[교육용 라이선스 신청 링크(수원대 이메일 필요)](https://www.jetbrains.com/shop/eform/students)

[다운로드(Ultimate)](https://www.jetbrains.com/idea/download/?section=windows)

# 오라클DB

## 설치

데이터베이스를 강의하시는 교수님의 강의자료를 참고하시면 도움이 됩니다.

교수님께서 강의자료실에 올려주신 설치파일로 설치하시는 것을 권장드립니다.

오라클 DB 버전은 11g 입니다.

SQL Developer 또한 설치가 필요합니다.

데이터베이스 수업을 들으신다면 오라클DB와 SQL Developer는 아마 다들 이미 설치되어 있으실 것입니다.

## (중요)포트 충돌 방지

스프링부트 프로젝트를 8080 포트에서 돌릴 것인데, 8080 웹 포트를 오라클DB 프로그램이 이미 사용을 하고 있어서, 오라클의 8080 웹 포트를 다른 걸로 수정해야 합니다.

### 포트 충돌이 일어나면(참고)

포트 충돌이 일어날 때, 어느 프로그램이 무슨 포트를 쓰고 있는지 궁금하다면,
[이 링크](https://velog.io/@maxine45/%EB%82%B4-8080-%ED%8F%AC%ED%8A%B8%EB%8A%94-%EB%88%84%EA%B0%80%EC%93%B0%EA%B3%A0%EC%9E%88%EB%8A%90%EB%83%90)를 참고하시어, 프로그램을 확인하실 수 있습니다.

### (중요)오라클DB가 사용중인 8080 웹 포트를 다른 포트로 변경
아마, 오라클DB가 8080을 쓰고 있는 것으로 나올 것입니다.
스프링부트가 8080을 사용할 것이기에, 오라클의 8080을 다른 것으로 바꿀 것입니다. (꼭 하셔야 합니다.)

1. Run SQL Command Line 프로그램을 실행합니다.
2. [이 링크](https://leeyongjin.tistory.com/entry/%EC%98%A4%EB%9D%BC%ED%81%B4-11g-express%EC%97%90%EC%84%9C-8080-%ED%8F%AC%ED%8A%B8-%EB%B3%80%EA%B2%BD)를 참고하여, 2번부터 수행합니다.

## 테이블스페이스, 계정 등 만들기

### 테이블스페이스 생성

1. SQL Developer 진입
2. SYSTEM 계정으로 접속
3. 보기 -> DBA 누르기
4. Local_SYSTEM -> 저장 영역 -> 테이블스페이스 우클릭 -> 새로 만들기

맨 위 이름 : BONGDAM_DB

그 아래 '파일 사양'의 이름: BONGDAM_WEB_DATA

디렉토리 : 컴퓨터의 적당한 장소에 폴더를 하나 생성하신 다음, 그 경로를 복사해 붙여넣으세요.

파일 크기: 200, M

자동 확장 설정 체크

다음 크기: 1280 (단위 생략)

최대 크기: 제한 없음

5. 속성 탭에 들어가세요

작은 파일, 온라인, 8192, 로깅, 자동, 로컬, 자동할당 선택

이후 확인 클릭

### 계정 추가

이제 계정을 추가해야 합니다.

접속에서 Local_SYSTEM (system 계정)에 접속합니다.

'다른 사용자'를 우클릭합니다.

사용자 생성 을 누르시고요.

사용자 이름: BONGDAM

비밀번호: 1234

기본 테이블스페이스: BONGDAM_DB

임시 테이블스페이스: TEMP

부여된 룰 탭 -> CONNECT, RESOURCE 권한이 부여됨 선택

할당량 탭 -> BONGDAM_DB 무제한 선택

이렇게 하시면 됩니다.

### 계정 접속 설정

접속 밑에 플러스 버튼이 있습니다.

name은 편하신 걸로 정하시고(저는 Local_BONGDAM 으로 했습니다)

사용자 이름: bongdam 비밀번호: 1234

비밀번호 저장 체크

그리고 저장하시면 됩니다.

계정에 접속하고 싶으실 땐, 왼쪽 접속 창에 보이는 Local_BONGDAM을 더블클릭하시면 됩니다.

# 백엔드 프로그램

## 인텔리제이로 열기

[백엔드 리포지토리](https://github.com/bongdam-safety/backend)

위 링크의 프로그램을 다운받으시거나, clone 하셔서, 인텔리제이로 엽니다.

오른쪽 아래 로딩바가 끝날때까지 기다리시면 됩니다.

dependency를 다시 로딩하려면, build.gragle 파일로 들어가신 다음

오른쪽 코끼리 모양 아이콘을 누르시고, 새로고침 모양 버튼을 누르시면 됩니다.

## 데이터베이스 최초생성(중요)

src -> main -> resources -> application.properties 파일로 들어갑니다.

spring.jpa.hibernate.ddl-auto=none 에서 none을 create로 바꿔줍니다.

(참고, 중요) create: 데이터베이스에 각종 테이블들을 새로 생성해주는 역할을 합니다. 만약 기존에 테이블들이 있다면 그것을을 모두 지워 초기화하고 다시 생성합니다.

오른쪽 위의 실행 버튼을 눌러 실행하실 수 있습니다.
만약, 콘솔창에 8080 포트로 열렸다고 표시가 되고 더 이상 로그가 안 나오면,

오른쪽 위의 빨간 버튼을 눌러 프로그램을 정지시킵니다.

## 사전에 조사했던 안전시설물 데이터 삽입

[SQL문](https://github.com/bongdam-safety/documents/blob/main/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4/exampleFacilities.sql)

위 페이지에 접속한 다음, 모든 코드를 복사합니다. (이것은, 사전에 봉담읍 주민자치회 위원님들께서 조사하셨던 안전시설물 데이터들입니다.)

그리고, SQL Developer 프로그램에 들어가서,

'접속'에 있는 bongdam 계정으로 접속하시고,

오른쪽 쿼리를 작성을 하는 곳에 붙여넣습니다.

그리고, 화살표 오른쪽에 있는 '스크립트 실행' 버튼 또는, F5 버튼을 눌러, 쿼리를 실행합니다.

(참고) SQL Developer에서 데이터베이스 확인하는 방법 : 왼쪽 접속에 있는 테이블 더블클릭 -> FACILITY(시설물) 또는 FACILITY_CATEGORY(시설물 분류) 더블클릭 -> 우측 상단 '데이터' 클릭

## (중요)시설물분류, 시설물 웹으로 삽입시, ID 제대로 들어가도록 하기

아래에 나와있는 것을 하지 않으면, 웹을 통해 데이터를 삽입하는 것이 불가능해집니다.

원래 웹을 통해 데이터를 집어넣으면 아이디가 1번부터 붙는데,

아까처럼 SQL문으로 집어넣으면, 그 아이디 수 카운트가 올라가지 않습니다.

그래서, 그 카운트를 수동으로 현재의 항목 개수로 올려주는 작업입니다.

[시퀀스 재설정 SQL 쿼리](https://github.com/bongdam-safety/documents/blob/main/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4/sequence_modify.sql)

위 링크에 접속하신 다음, 모두 복사하고 붙여넣으세요.

**이거는, 아까의 SQL문처럼 한꺼번에 실행하시면 안됩니다.**

1번부터 차례대로 수행하시면 되고요, 2번과 3번에서 출력된 값을 기억해둔 다음에,

(2번에서 출력된 값 - 3번에서 출력된 값 - 1) 을 계산하신 다음,

4번의 "오른쪽 참고해 계산한 숫자"라고 쓰여있는 곳에 그 수를 대입하고 실행하시고,

그 다음으로 5, 6, 7, 8 , 9를 차례대로 실행하시면 됩니다.

그 아래에도 1번부터 9번까지 있는데요, 이것도 마찬가지의 방법으로 다시 계산하시고,

대입하시고, 차례대로 실행하시면 됩니다.

## DB 작업을 마쳤으면

이제 SQL Developer 프로그램을 종료합니다. (변경사항을 커밋하겠냐고 하면, 커밋한다고 하세요.) / SQL Developer를 종료하지 않으면 데이터 조회, 삽입이 잘 안 되더라고요

## (중요)다시 프로그램 실행

인텔리제이로 돌아와서, src -> main -> resources -> application.properties 파일로 들어갑니다.

spring.jpa.hibernate.ddl-auto=create 에서 create를 none으로 바꿔줍니다.

### (재설명, 중요) create와 none

 create: 데이터베이스에 각종 테이블들을 새로 생성해주는 역할을 합니다. 만약 기존에 테이블들이 있다면 그것을을 모두 지워 초기화하고 다시 생성합니다. 만약 이걸 none으로 안 바꾸면, 아까 DB에 추가했던 모든 시설물 데이터들이 없어집니다.

오른쪽 위의 실행 버튼을 눌러 실행하실 수 있습니다.

## 데이터 보내고 받기

참고 : 아래 실습은 인텔리제이에서 프로그램을 실행 중인 상태여야 가능합니다.

### Postman 프로그램 설치

[Postman 다운로드 링크](https://www.postman.com/downloads/)

위 링크에 접속하셔서, Postman을 설치하세요.

#### 데이터 받아오기

##### GET

우선 GET 은 데이터를 받아올 때 사용합니다.

데이터를 JSON 형식으로 받아올 수 있습니다.

**프론트엔드 쪽에서는, 이 데이터를 받아와서, 선택되어 있는 분류에 해당하는 안전시설물을 지도에 표시하고, 그걸 누르면 아래에서 그 시설물의 정보를 표 형태로 볼 수 있게 해주셔야 합니다.**

Postman 프로그램에서, 주소에는 localhost:8080/api/facility 를 입력하고, 왼쪽은 GET 으로 설정합니다. 그리고 Send를 클릭하세요

그러면, 이제 시설물 데이터를 불러올 수 있습니다.

그 다음으로, localhost:8080/api/facilityCategory 를 입력하고, Send를 누르시면, 시설물 분류를 보실 수 있습니다.

또한, 크롬이나 엣지 등의 브라우저에서 위 링크들을 치고 들어가셔도 정보를 확인하실 수 있습니다.

그리고 한가지 정보를 알려드리자면, 파이어폭스 브라우저에서 보면 보기 좋은 형태로 보실 수 있습니다.

##### POST

###### 시설물 분류

이제, 데이터를 전송을 해서 데이터베이스에 저장을 해볼 것입니다.

카테고리 추가를 해보겠습니다. 주소는 localhost:8080/api/facilityCategory, 왼쪽은 POST로 설정을 하세요.

그리고, 주소 입력창 아래에, "Body"를 누르시고, 그 아래 버튼들 중 "raw"를 누르세요.

그리고 아래와 같이 입력합니다.

    {
        "categoryName": "테스트2",
        "visible": true
    }

그리고, Send를 눌러 데이터를 전송합니다.

그 다음 위에서 말한 방법으로, GET을 통해 정보를 받아보면, DB에 정보가 잘 저장된 것을 알 수 있습니다.

또한 카테고리 번호도 자동으로 12번으로 부여된 것을 알 수 있습니다.

(아까 SQL문을 이용해서 sequence 설정을 했던 게, 이 번호 부여를 제대로 하도록 하기 위함이었습니다.)

###### 시설물

이제, 시설물 추가를 해보겠습니다.

주소는 localhost:8080/api/facility 그리고 왼쪽은 POST로 설정합니다.

아까와 마찬가지로, Body 및 raw 를 클릭합니다. 그리고 아래와 같이 입력합니다.

    {
        "facilityCategoryId" : 12,
        "latitude" : 1.1,
        "longitude" : 2.2,
        "content" : "테스트입니다",
        "note_for_manager" : "관리자만 볼 수 있는 설명입니다."
    }

위 정보는 각각 시설물분류 번호, 위도, 경도, 설명, 관리자만 볼 수 있는 설명입니다.

위에서 했던 것과 마찬가지로, GET을 통해 정보를 받아보면, 정보가 잘 추가된 것을 확인할 수 있습니다.

# 유의사항

## 회원가입은 일반인이 하는 것이 아닙니다

일반인은 로그인 없이 정보수정요청, 신규장소 추가요청, 센터에 요청 등을 수행할 수 있습니다.

그러므로, 일반인은 회원가입 및 로그인을 할 필요가 없습니다.

## 회원가입은 관리자가 새 관리자를 등록할 때에만 수행

로그인 및 계정 기능은, **관리자의 시설물 추가요청 승인, 정보 수정요청 승인, 센터에 들어온 요청 확인**을 위해 필요합니다.

일단, 제가 나중에 데이터베이스에 최고 관리자를 수동으로 하나 만들어놓을 겁니다.
그리고, 관리자가 관리자 페이지에서, 추가로 관리자 계정을 생성할 수 있도록 할 것입니다.

그리고 백엔드의 src > main > java > kr.co.bongdamsafety.olinemap > entity > Account.java 파일을 보시면, permlevel 이라는 것이 있습니다.

이것의 목적이 뭐냐면,

0 : 권한없음(예를 들어 원래는 관리자였는데, 사퇴 등의 이유로 관리를 하면 안되는 사람이 된 경우)

1 : 일반 관리자 (정보수정요청 승인, 신규추가요청 승인, 신규장소 추가, 정보수정)

2 : 최고 관리자 (1번의 모든 일을 수행할 수 있을 뿐 아니라 회원 추가 및 권한 관리가 가능한 관리자)

이렇게 하려는 게 목적이었습니다.

그리고, 비회원 상태에서는, 정보수정 요청, 신규장소 추가요청, 센터에 요청 등은 자유롭게 가능합니다.

## 센터에 요청

센터에 요청은 뭐냐면, 봉담읍 주민자치회에 요청을 하는 것입니다.

내년에, 자치회에서 봉담읍 안전거리 조성 사업을 수행하게 되면, 실제 안전시설물 설치 등을 하는 데 있어서 해당 제보 정보를 사용할 계획입니다.

## 분류는 추가될 수 있습니다(변경 가능합니다)
그러므로, GET을 통해 분류들을 불러오고, 드롭다운 리스트에 표시를 하고, 거기서 선택을 하고, 선택된 분류에 속한 시설물들을 지도에 보여줘야 합니다.

# 모두들 수고 많으십니다.

다들 프로젝트가 처음으라 많이 힘드실 거에요

몸 건강도 챙기면서 프로젝트를 하도록 합시다.

좋은 하루 보내시길 바라겠습니다.

고맙습니다.
